#!/usr/bin/env python3

import csv

{{ postprocess_script }}


pattern = re.compile(r"{{ regex }}")

def read_log(log_file):
    with open(log_file, 'r') as file:
        match = pattern.match(file.read())
        if match != None:
            return match.groupdict()

data = process_bench('.', read_log, metadata_file='metadata.json', include_metrics=True)

with open('results.csv', 'w', newline='') as csvfile:
    fieldnames = list(set().union(*(d.keys() for d in data)))
    fieldnames.sort()
    writer = csv.DictWriter(csvfile, fieldnames=fieldnames)
    writer.writeheader()
    writer.writerows(data)


